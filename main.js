(()=>{"use strict";var e=document.querySelector(".popup__container_type_image"),t=e.querySelector(".view-image__item"),o=e.querySelector(".view-image__caption");function n(e){e.classList.add("popup_opened"),document.addEventListener("keyup",c)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keyup",c)}function c(e){"Escape"===e.code&&r(document.querySelector(".popup_opened"))}function a(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(o.inactiveButtonClass),t.disabled=!1):(t.classList.add(o.inactiveButtonClass),t.disabled=!0)}document.querySelectorAll(".popup");var i={baseUrl:"https://nomoreparties.co/v1/plus-cohort-5",headers:{authorization:"31d8c365-d1c0-426e-b228-1cdaf2cce2be"}},u={method:"DELETE",headers:i.headers},s={method:"PUT",headers:i.headers},l={method:"DELETE",headers:i.headers},d=document.querySelector(".elements"),f=document.querySelector(".popup__container_type_image").closest(".popup");function p(e,r){var c=document.querySelector("#place-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image"),d=c.querySelector(".card__button-trash"),p=c.querySelector(".card__button-like"),m=c.querySelector(".like-block__caption"),_=e.likes.some((function(e){return e._id===r}));return a.setAttribute("src",e.link),a.setAttribute("alt",e.name),c.querySelector(".card__caption-name").textContent=e.name,e.owner._id===r&&d.classList.add("card__button-trash_created"),_&&p.classList.add("active"),m.textContent=e.likes.length,c.querySelector(".card__button-like").addEventListener("click",(function(t){var o,n=t.target;"card__button-like"===n.getAttribute("class")?(o=e._id,fetch("".concat(i.baseUrl,"/cards/likes/").concat(o),s)).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){m.textContent=e.likes.length,n.classList.add("active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),l)}(e._id).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){m.textContent=e.likes.length,n.classList.remove("active")})).catch((function(e){console.log(e)}))})),c.querySelector(".card__button-trash").addEventListener("click",(function(t){var o;t.target.closest(".card").remove(),o=e._id,fetch("".concat(i.baseUrl,"/cards/").concat(o),u)})),a.addEventListener("click",(function(r){var c,a;n(f),c=e.link,a=e.name,t.setAttribute("src",c),t.setAttribute("alt",a),o.textContent=a})),c}function m(e){d.prepend(e)}var _,v="Сохранение...",h="Сохранить",y=document.querySelector(".profile__button-edit"),b=document.querySelector(".popup__container_type_edit"),S=b.closest(".popup"),q=b.querySelector("#person"),L=b.querySelector("#profession"),C=document.querySelector(".profile"),k=C.querySelector(".profile__img"),E=C.querySelector(".profile-edit__title"),g=C.querySelector(".profile-edit__subtitle"),x=document.querySelector(".profile__edit-label"),j=document.querySelector(".popup__container_type_avatar"),A=j.closest(".popup"),P=j.querySelector("#avatar-link"),U=j.querySelector(".form"),T=U.querySelector(".form__button-submit"),z=document.querySelector(".profile__button-add"),D=document.querySelector(".popup__container_type_add"),w=D.closest(".popup"),B=D.querySelector("#place"),N=D.querySelector("#image-link"),O=(document.querySelectorAll(".popup__button-close"),b.querySelector(".form")),J=b.querySelector(".form__button-submit"),H=D.querySelector(".form"),F=H.querySelector(".form__button-submit"),M=(document.querySelector(".elements"),document.querySelector(".popup__container_type_image").closest(".popup"),"");_={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button-submit",inactiveButtonClass:"form__button-submit_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"},Array.from(document.querySelectorAll(_.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);a(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(e,r,t),a(o,n,t)}))}))}(e,_)})),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__button-close"))&&r(e)}))})),k.addEventListener("mouseover",(function(e){x.classList.add("profile__edit-label_show")})),k.addEventListener("mouseout",(function(e){x.classList.remove("profile__edit-label_show")})),k.addEventListener("click",(function(e){n(A)})),x.addEventListener("mouseover",(function(e){k.classList.add("profile__img:hover")})),x.addEventListener("mouseout",(function(e){k.classList.remove("profile__img:hover")})),y.addEventListener("click",(function(e){n(S),q.value=E.textContent,L.value=g.textContent})),z.addEventListener("click",(function(e){n(w)})),O.addEventListener("submit",(function(e){var t,o;e.preventDefault(),J.textContent=v,(t=q.value,o=L.value,fetch("".concat(i.baseUrl,"/users/me"),function(e,t){return{method:"PATCH",headers:{authorization:i.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}}(t,o))).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){E.textContent=e.name,g.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(e){J.textContent=h,r(S)}))})),H.addEventListener("submit",(function(e){var t,o;e.preventDefault(),F.textContent=v,(t=B.value,o=N.value,fetch("".concat(i.baseUrl,"/cards"),function(e,t){return{method:"POST",headers:{authorization:i.headers.authorization,"Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify({name:e,link:t})}}(t,o))).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){m(p(e,M))})).catch((function(e){console.log(e)})).finally((function(e){H.reset(),F.disabled=!0,F.classList.add("form__button-submit_inactive"),F.textContent=h,r(w)}))})),U.addEventListener("submit",(function(e){var t;e.preventDefault(),T.textContent=v,(t=P.value,fetch("".concat(i.baseUrl,"/users/me/avatar"),function(e){return{method:"PATCH",headers:{authorization:i.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(e)})}}(t))).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){k.setAttribute("src",P.value),P.value=""})).catch((function(e){console.log(e)})).finally((function(e){T.textContent=h,r(A)}))})),fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){k.setAttribute("src",e.avatar),E.textContent=e.name,g.textContent=e.about,M=e._id})).catch((function(e){console.log(e)})),fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){e.forEach((function(e){m(p(e,M))}))})).catch((function(e){console.log(e)}))})();